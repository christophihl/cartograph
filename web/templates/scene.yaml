scene:
    background:
        color: '#F0F7FF'

styles:
    point-alpha:
        base: points
        blend: overlay
    poly-alpha:
        base: polygons
        blend: overlay
    line-alpha:
        base: lines
        blend: inlay

sources:
    vector:
        type: TopoJSON
        url: {{ Server.base_url }}/vector/gender/{z}/{x}/{y}.topojson
        max_zoom: 16
    raster:
        type: Raster
        url: {{ Server.base_url }}/raster/gender/{z}/{x}/{y}.png
        max_zoom: 16

layers:
#    base:
#        data: { source: raster }
#        draw:
#            raster:
#                order: 0 # draw on bottom
    countries:
        data: { source: vector, layer: countries }
        draw:
            lines:
                color: gray
                width: 1px
                visible: true
                order: 2
                blend: overlay
                collide: false
    {% for cluster, clusterColors  in ColorWheel.items() %}
        country_{{ cluster }}:
            filter: { clusterid : {{ cluster}} }
            draw:
                polygons:
                    color: '{{ clusterColors[7] }}'
                    width: 1px
                    order: 2
    {% endfor %}

    contours :
        data : { source: vector, layer: centroid_contours }

    {% for cluster, clusterColors  in ColorWheel.items() %}
      {% for contour, contourColor in clusterColors.items() %}
        contour_{{cluster}}_{{contour}}:
            filter: { contourid : {{ cluster }}_{{ contour }} }
            draw:
                polygons:
                    color: '{{ contourColor }}'
                    width: 1px
                    order: {{ loop.index + 2 }}
      {% endfor %}
    {% endfor %}

    capitals:
        data: { source: vector, layer: countries_labels }
        draw:
          points:
            color: '#dd9999'
            size: 0px
            collide: false
            text:
              text_source: name
              anchor: center
              collide: false
              font:
                  family: Arial
                  size: 16px
                  weight: 700
                  transform: uppercase
                  fill: 'rgba(255, 255, 255, 0.5)'
                  stroke: { color: '#666', width: 1px }
    cities:
        data: { source: vector, layer: cities }
        small_cities:
            filter: { zoff : { min: -100, max: 1.0 } }
            draw:
                points:
                  interactive: true
                  collide: false
                  color: 'rgba(221,153,153,0.5)'
                  size: 4px
                  priority: function() { return 1000000 + feature.zpop; }
        medium_cities:
            filter: { zoff : { min: 1.0, max: 2 } }
            draw:
                points:
                  order: 1000
                  interactive: true
                  color: '#dd9999'
                  size: 5px
                  priority: function() { return 100000 + feature.zpop ; }
                  text:
                    order: 1000
                    text_source: name
                    interactive: true
                    priority: function() { return 100000 + feature.zpop ; }
                    font:
                        family: Arial
                        size: 11px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
        large_cities:
            filter: { zoff : { min: 2, max: 4 } }
            draw:
                points:
                  order: 1000
                  interactive: true
                  color: '#dd9999'
                  size: 7px
                  priority: function() { return 10000 + feature.zpop; }
                  text:
                    order: 1000
                    text_source: name
                    interactive: true
                    priority: function() { return 10000 + feature.pop; }
                    font:
                        family: Arial
                        size: 13px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
        huge_cities:
            filter: { zoff : { min: 5 } }
            draw:
                points:
                  order: 1000
                  interactive: true
                  color: '#dd9999'
                  size: 14px
                  priority: function() { return 5000 + feature.zpop; }
                  text:
                    order: 1000
                    text_source: city
                    interactive: true
                    priority: function() { return 5000 + feature.zpop; }
                    font:
                        family: Arial
                        size: 15px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
    edges:
        data: { source: tiled, layer: edges }
        filter: { $zoom: { min: 6 } }
        draw:
            lines:
                collide: false
                style: line-alpha
                color: 'rgba(150,120,120,0.2)'
                width: 1px
                visible: true
                order: 0
