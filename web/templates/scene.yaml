scene:
    background:
        color: '#F0F7FF'

styles:
    point-alpha:
        base: points
        blend: overlay
    poly-alpha:
        base: polygons
        blend: overlay
    line-alpha:
        base: lines
        blend: inlay

sources:
    vector:
        type: TopoJSON
        url: {{ Server.base_url }}/vector/gender/{z}/{x}/{y}.topojson
        max_zoom: 16
    raster:
        type: Raster
        url: {{ Server.base_url }}/raster/gender/{z}/{x}/{y}.png
        max_zoom: 16

layers:
    base:
        data: { source: raster }
        filter: { $zoom : { max : {{ Server.vector_zoom }} } }
        draw:
            raster:
                order: 0 # draw on bottom
    countries:
        data: { source: vector, layer: countries }
        draw:
            lines:
                color: gray
                width: 1px
                visible: true
                order: 2
                blend: overlay
                collide: false
    {% for cluster, clusterColors  in ColorWheel.items() %}
        country_{{ cluster }}:
            filter: { clusterid : '{{ cluster }}' }
            draw:
                polygons:
                    color: '{{ clusterColors[7] }}'
                    width: 1px
                    collide: false
                    order: 2
    {% endfor %}

    contours :
        data : { source: vector, layer: centroid_contours }

    {% for cluster, clusterColors  in ColorWheel.items() %}
      {% for contour, contourColor in clusterColors.items() %}
        contour_{{cluster}}_{{contour}}:
            filter: { contourid : '{{ cluster }}_{{ contour }}' }
            draw:
                polygons:
                    color: '{{ contourColor }}'
                    collide: false
                    width: 1px
                    order: {{ loop.index + 2 }}
      {% endfor %}
    {% endfor %}
#
#    capitals:
#        data: { source: vector, layer: countries_labels }
#        draw:
#          points:
#            color: '#dd9999'
#            size: 0px
#            collide: false
#            text:
#              text_source: name
#              anchor: center
#              collide: false
#              font:
#                  family: Arial
#                  size: 16px
#                  weight: 700
#                  transform: uppercase
#                  fill: 'rgba(255, 255, 255, 0.5)'
#                  stroke: { color: '#666', width: 1px }
    extraPoints:
        data: { source: vector, layer: extraPoints }
        draw:
            points:
              collide: false
              color: function() { return feature.color; }
              size: 4px
    cities:
        data: { source: vector, layer: cities }
        small_cities:
            filter: { zoff : { min: -100, max: 1 } }
            draw:
                points:
                  interactive: true
                  collide: false
                  color: function() { return feature.color; }
                  size: 6px
                  priority: function() { return feature.zpop; }
                  text:
                    required: false
                    order: 1000
                    text_source: name
                    interactive: true
#                    collide: false
                    font:
                        family: Arial
                        size: 8px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
        medium_cities:
            filter: { zoff : { min: 1, max: 2 } }
            draw:
                points:
                  order: 1000
                  interactive: true
                  collide: false
                  color: function() { return feature.color; }
                  size: 8px
                  priority: function() { return feature.zpop ; }
                  text:
                    required: false
                    order: 1000
                    text_source: name
                    interactive: true
#                    collide: false
                    font:
                        family: Arial
                        size: 10px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
        large_cities:
            filter: { zoff : { min: 2, max: 5 } }
            draw:
                points:
                  order: 1000
                  interactive: true
                  collide: false
                  color: function() { return feature.color; }
                  size: 10px
                  priority: function() { return  feature.zpop; }
                  text:
                    required: false
                    order: 1000
                    text_source: name
                    interactive: true
#                    collide: false
                    font:
                        family: Arial
                        size: 14px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
        huge_cities:
            filter: { zoff : { min: 5, max: 5000 } }
            draw:
                points:
                  order: 1000
                  interactive: true
                  collide: false
                  color: function() { return feature.color; }
                  size: 15px
                  priority: function() { return  feature.zpop; }
                  text:
                    required: false
                    order: 1000
                    text_source: name
                    interactive: true
                    collide: false
                    font:
                        family: Arial
                        size: 20px
                        fill: '#666'
                        stroke: { color: '#fff', width: 2 }
#    edges:
#        data: { source: tiled, layer: edges }
#        filter: { $zoom: { min: 6 } }
#        draw:
#            lines:
#                collide: false
#                style: line-alpha
#                color: 'rgba(150,120,120,0.2)'
#                width: 1px
#                visible: true
#                order: 0
